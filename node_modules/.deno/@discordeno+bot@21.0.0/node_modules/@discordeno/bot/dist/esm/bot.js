import { ShardSocketCloseCodes, createGatewayManager } from '@discordeno/gateway';
import { createRestManager } from '@discordeno/rest';
import { createLogger, getBotIdFromToken } from '@discordeno/utils';
import { createBotGatewayHandlers } from './handlers.js';
import { createBotHelpers } from './helpers.js';
import { createTransformers } from './transformers.js';
export function createBot(options) {
    if (!options.transformers) options.transformers = {};
    if (!options.transformers.desiredProperties) options.transformers.desiredProperties = options.desiredProperties;
    if (!options.rest) options.rest = {
        token: options.token,
        applicationId: options.applicationId
    };
    if (!options.rest.token) options.rest.token = options.token;
    if (!options.rest.logger && options.loggerFactory) options.rest.logger = options.loggerFactory('REST');
    if (!options.gateway) options.gateway = {
        token: options.token
    };
    if (!options.gateway.token) options.gateway.token = options.token;
    if (!options.gateway.events) options.gateway.events = {};
    if (!options.gateway.logger && options.loggerFactory) options.gateway.logger = options.loggerFactory('GATEWAY');
    if (!options.gateway.events.message) {
        options.gateway.events.message = async (shard, data)=>{
            // TRIGGER RAW EVENT
            bot.events.raw?.(data, shard.id);
            if (!data.t) return;
            // RUN DISPATCH CHECK
            await bot.events.dispatchRequirements?.(data, shard.id);
            bot.handlers[data.t]?.(bot, data, shard.id);
        };
    }
    options.gateway.intents = options.intents;
    options.gateway.preferSnakeCase = true;
    const id = getBotIdFromToken(options.token);
    const bot = {
        id,
        applicationId: id,
        transformers: createTransformers(options.transformers),
        handlers: createBotGatewayHandlers(options.handlers ?? {}),
        rest: createRestManager(options.rest),
        gateway: createGatewayManager(options.gateway),
        events: options.events ?? {},
        logger: options.loggerFactory ? options.loggerFactory('BOT') : createLogger({
            name: 'BOT'
        }),
        // Set up helpers below.
        helpers: {},
        async start () {
            if (!options.gateway?.connection) {
                bot.gateway.connection = await bot.rest.getSessionInfo();
                // Check for overrides in the configuration
                if (!options.gateway?.url) bot.gateway.url = bot.gateway.connection.url;
                if (!options.gateway?.totalShards) bot.gateway.totalShards = bot.gateway.connection.shards;
                if (!options.gateway?.lastShardId && !options.gateway?.totalShards) bot.gateway.lastShardId = bot.gateway.connection.shards - 1;
            }
            if (!bot.gateway.resharding.getSessionInfo) {
                bot.gateway.resharding.getSessionInfo = async ()=>{
                    return await bot.rest.getGatewayBot();
                };
            }
            await bot.gateway.spawnShards();
        },
        async shutdown () {
            return await bot.gateway.shutdown(ShardSocketCloseCodes.Shutdown, 'User requested bot stop');
        }
    };
    bot.helpers = createBotHelpers(bot);
    if (options.applicationId) bot.applicationId = bot.transformers.snowflake(options.applicationId);
    return bot;
}

//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uLy4uL3NyYy9ib3QudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHR5cGUgeyBDcmVhdGVHYXRld2F5TWFuYWdlck9wdGlvbnMsIEdhdGV3YXlNYW5hZ2VyIH0gZnJvbSAnQGRpc2NvcmRlbm8vZ2F0ZXdheSdcbmltcG9ydCB7IFNoYXJkU29ja2V0Q2xvc2VDb2RlcywgY3JlYXRlR2F0ZXdheU1hbmFnZXIgfSBmcm9tICdAZGlzY29yZGVuby9nYXRld2F5J1xuaW1wb3J0IHR5cGUgeyBDcmVhdGVSZXN0TWFuYWdlck9wdGlvbnMsIFJlc3RNYW5hZ2VyIH0gZnJvbSAnQGRpc2NvcmRlbm8vcmVzdCdcbmltcG9ydCB7IGNyZWF0ZVJlc3RNYW5hZ2VyIH0gZnJvbSAnQGRpc2NvcmRlbm8vcmVzdCdcbmltcG9ydCB0eXBlIHsgQmlnU3RyaW5nLCBHYXRld2F5RGlzcGF0Y2hFdmVudE5hbWVzLCBHYXRld2F5SW50ZW50cywgUmVjdXJzaXZlUGFydGlhbCB9IGZyb20gJ0BkaXNjb3JkZW5vL3R5cGVzJ1xuaW1wb3J0IHsgY3JlYXRlTG9nZ2VyLCBnZXRCb3RJZEZyb21Ub2tlbiwgdHlwZSBsb2dnZXIgfSBmcm9tICdAZGlzY29yZGVuby91dGlscydcbmltcG9ydCB0eXBlIHtcbiAgQ29tcGxldGVEZXNpcmVkUHJvcGVydGllcyxcbiAgRGVzaXJlZFByb3BlcnRpZXNCZWhhdmlvcixcbiAgU2V0dXBEZXNpcmVkUHJvcHMsXG4gIFRyYW5zZm9ybWVyc0Rlc2lyZWRQcm9wZXJ0aWVzLFxuICBUcmFuc2Zvcm1lcnNPYmplY3RzLFxufSBmcm9tICcuL2Rlc2lyZWRQcm9wZXJ0aWVzLmpzJ1xuaW1wb3J0IHR5cGUgeyBFdmVudEhhbmRsZXJzIH0gZnJvbSAnLi9ldmVudHMuanMnXG5pbXBvcnQgeyB0eXBlIEJvdEdhdGV3YXlIYW5kbGVyLCB0eXBlIEdhdGV3YXlIYW5kbGVycywgY3JlYXRlQm90R2F0ZXdheUhhbmRsZXJzIH0gZnJvbSAnLi9oYW5kbGVycy5qcydcbmltcG9ydCB7IHR5cGUgQm90SGVscGVycywgY3JlYXRlQm90SGVscGVycyB9IGZyb20gJy4vaGVscGVycy5qcydcbmltcG9ydCB7IHR5cGUgVHJhbnNmb3JtZXJzLCBjcmVhdGVUcmFuc2Zvcm1lcnMgfSBmcm9tICcuL3RyYW5zZm9ybWVycy5qcydcblxuLyoqXG4gKiBDcmVhdGUgYSBib3Qgb2JqZWN0IHRoYXQgd2lsbCBtYWludGFpbiB0aGUgcmVzdCBhbmQgZ2F0ZXdheSBjb25uZWN0aW9uLlxuICpcbiAqIEBwYXJhbSBvcHRpb25zIENvbmZpZ3VyYXRpb25zIG9wdGlvbnMgdXNlZCB0byBtYW5hZ2UgdGhpcyBib3QuXG4gKiBAcmV0dXJucyBCb3RcbiAqL1xuXG4vLyBPdmVybG9hZHMgdG8gYXZvaWQgYWRkaW5nIENvbXBsZXRlRGVzaXJlZFByb3BlcnRpZXMgaWYgd2UgYXJlIGdpdmVuIGEgY29tcGxldGUgb2JqZWN0XG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQm90PFxuICBUUHJvcHMgZXh0ZW5kcyBUcmFuc2Zvcm1lcnNEZXNpcmVkUHJvcGVydGllcyxcbiAgVEJlaGF2aW9yIGV4dGVuZHMgRGVzaXJlZFByb3BlcnRpZXNCZWhhdmlvciA9IERlc2lyZWRQcm9wZXJ0aWVzQmVoYXZpb3IuUmVtb3ZlS2V5LFxuPihvcHRpb25zOiBDcmVhdGVCb3RPcHRpb25zPFRQcm9wcywgVEJlaGF2aW9yPik6IEJvdDxUUHJvcHMsIFRCZWhhdmlvcj5cbmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVCb3Q8XG4gIFRQcm9wcyBleHRlbmRzIFJlY3Vyc2l2ZVBhcnRpYWw8VHJhbnNmb3JtZXJzRGVzaXJlZFByb3BlcnRpZXM+LFxuICBUQmVoYXZpb3IgZXh0ZW5kcyBEZXNpcmVkUHJvcGVydGllc0JlaGF2aW9yID0gRGVzaXJlZFByb3BlcnRpZXNCZWhhdmlvci5SZW1vdmVLZXksXG4+KG9wdGlvbnM6IENyZWF0ZUJvdE9wdGlvbnM8VFByb3BzLCBUQmVoYXZpb3I+KTogQm90PENvbXBsZXRlRGVzaXJlZFByb3BlcnRpZXM8VFByb3BzPiwgVEJlaGF2aW9yPlxuXG5leHBvcnQgZnVuY3Rpb24gY3JlYXRlQm90PFxuICBUUHJvcHMgZXh0ZW5kcyBSZWN1cnNpdmVQYXJ0aWFsPFRyYW5zZm9ybWVyc0Rlc2lyZWRQcm9wZXJ0aWVzPixcbiAgVEJlaGF2aW9yIGV4dGVuZHMgRGVzaXJlZFByb3BlcnRpZXNCZWhhdmlvciA9IERlc2lyZWRQcm9wZXJ0aWVzQmVoYXZpb3IuUmVtb3ZlS2V5LFxuPihvcHRpb25zOiBDcmVhdGVCb3RPcHRpb25zPFRQcm9wcywgVEJlaGF2aW9yPik6IEJvdDxDb21wbGV0ZURlc2lyZWRQcm9wZXJ0aWVzPFRQcm9wcz4sIFRCZWhhdmlvcj4ge1xuICB0eXBlIENvbXBsZXRlUHJvcHMgPSBDb21wbGV0ZURlc2lyZWRQcm9wZXJ0aWVzPFRQcm9wcz5cbiAgdHlwZSBUeXBlZEJvdCA9IEJvdDxDb21wbGV0ZVByb3BzLCBUQmVoYXZpb3I+XG5cbiAgaWYgKCFvcHRpb25zLnRyYW5zZm9ybWVycykgb3B0aW9ucy50cmFuc2Zvcm1lcnMgPSB7fVxuICBpZiAoIW9wdGlvbnMudHJhbnNmb3JtZXJzLmRlc2lyZWRQcm9wZXJ0aWVzKSBvcHRpb25zLnRyYW5zZm9ybWVycy5kZXNpcmVkUHJvcGVydGllcyA9IG9wdGlvbnMuZGVzaXJlZFByb3BlcnRpZXNcbiAgaWYgKCFvcHRpb25zLnJlc3QpIG9wdGlvbnMucmVzdCA9IHsgdG9rZW46IG9wdGlvbnMudG9rZW4sIGFwcGxpY2F0aW9uSWQ6IG9wdGlvbnMuYXBwbGljYXRpb25JZCB9XG4gIGlmICghb3B0aW9ucy5yZXN0LnRva2VuKSBvcHRpb25zLnJlc3QudG9rZW4gPSBvcHRpb25zLnRva2VuXG4gIGlmICghb3B0aW9ucy5yZXN0LmxvZ2dlciAmJiBvcHRpb25zLmxvZ2dlckZhY3RvcnkpIG9wdGlvbnMucmVzdC5sb2dnZXIgPSBvcHRpb25zLmxvZ2dlckZhY3RvcnkoJ1JFU1QnKVxuICBpZiAoIW9wdGlvbnMuZ2F0ZXdheSkgb3B0aW9ucy5nYXRld2F5ID0geyB0b2tlbjogb3B0aW9ucy50b2tlbiB9XG4gIGlmICghb3B0aW9ucy5nYXRld2F5LnRva2VuKSBvcHRpb25zLmdhdGV3YXkudG9rZW4gPSBvcHRpb25zLnRva2VuXG4gIGlmICghb3B0aW9ucy5nYXRld2F5LmV2ZW50cykgb3B0aW9ucy5nYXRld2F5LmV2ZW50cyA9IHt9XG4gIGlmICghb3B0aW9ucy5nYXRld2F5LmxvZ2dlciAmJiBvcHRpb25zLmxvZ2dlckZhY3RvcnkpIG9wdGlvbnMuZ2F0ZXdheS5sb2dnZXIgPSBvcHRpb25zLmxvZ2dlckZhY3RvcnkoJ0dBVEVXQVknKVxuICBpZiAoIW9wdGlvbnMuZ2F0ZXdheS5ldmVudHMubWVzc2FnZSkge1xuICAgIG9wdGlvbnMuZ2F0ZXdheS5ldmVudHMubWVzc2FnZSA9IGFzeW5jIChzaGFyZCwgZGF0YSkgPT4ge1xuICAgICAgLy8gVFJJR0dFUiBSQVcgRVZFTlRcbiAgICAgIGJvdC5ldmVudHMucmF3Py4oZGF0YSwgc2hhcmQuaWQpXG5cbiAgICAgIGlmICghZGF0YS50KSByZXR1cm5cblxuICAgICAgLy8gUlVOIERJU1BBVENIIENIRUNLXG4gICAgICBhd2FpdCBib3QuZXZlbnRzLmRpc3BhdGNoUmVxdWlyZW1lbnRzPy4oZGF0YSwgc2hhcmQuaWQpXG4gICAgICBib3QuaGFuZGxlcnNbZGF0YS50IGFzIEdhdGV3YXlEaXNwYXRjaEV2ZW50TmFtZXNdPy4oYm90LCBkYXRhLCBzaGFyZC5pZClcbiAgICB9XG4gIH1cblxuICBvcHRpb25zLmdhdGV3YXkuaW50ZW50cyA9IG9wdGlvbnMuaW50ZW50c1xuICBvcHRpb25zLmdhdGV3YXkucHJlZmVyU25ha2VDYXNlID0gdHJ1ZVxuXG4gIGNvbnN0IGlkID0gZ2V0Qm90SWRGcm9tVG9rZW4ob3B0aW9ucy50b2tlbilcblxuICBjb25zdCBib3Q6IFR5cGVkQm90ID0ge1xuICAgIGlkLFxuICAgIGFwcGxpY2F0aW9uSWQ6IGlkLFxuICAgIHRyYW5zZm9ybWVyczogY3JlYXRlVHJhbnNmb3JtZXJzKG9wdGlvbnMudHJhbnNmb3JtZXJzKSBhcyBUeXBlZEJvdFsndHJhbnNmb3JtZXJzJ10sXG4gICAgaGFuZGxlcnM6IGNyZWF0ZUJvdEdhdGV3YXlIYW5kbGVyczxDb21wbGV0ZVByb3BzLCBUQmVoYXZpb3I+KG9wdGlvbnMuaGFuZGxlcnMgPz8ge30pLFxuICAgIHJlc3Q6IGNyZWF0ZVJlc3RNYW5hZ2VyKG9wdGlvbnMucmVzdCBhcyBDcmVhdGVSZXN0TWFuYWdlck9wdGlvbnMpLFxuICAgIGdhdGV3YXk6IGNyZWF0ZUdhdGV3YXlNYW5hZ2VyKG9wdGlvbnMuZ2F0ZXdheSBhcyBDcmVhdGVHYXRld2F5TWFuYWdlck9wdGlvbnMpLFxuICAgIGV2ZW50czogb3B0aW9ucy5ldmVudHMgPz8ge30sXG4gICAgbG9nZ2VyOiBvcHRpb25zLmxvZ2dlckZhY3RvcnkgPyBvcHRpb25zLmxvZ2dlckZhY3RvcnkoJ0JPVCcpIDogY3JlYXRlTG9nZ2VyKHsgbmFtZTogJ0JPVCcgfSksXG4gICAgLy8gU2V0IHVwIGhlbHBlcnMgYmVsb3cuXG4gICAgaGVscGVyczoge30gYXMgQm90SGVscGVyczxDb21wbGV0ZVByb3BzLCBUQmVoYXZpb3I+LFxuICAgIGFzeW5jIHN0YXJ0KCkge1xuICAgICAgaWYgKCFvcHRpb25zLmdhdGV3YXk/LmNvbm5lY3Rpb24pIHtcbiAgICAgICAgYm90LmdhdGV3YXkuY29ubmVjdGlvbiA9IGF3YWl0IGJvdC5yZXN0LmdldFNlc3Npb25JbmZvKClcblxuICAgICAgICAvLyBDaGVjayBmb3Igb3ZlcnJpZGVzIGluIHRoZSBjb25maWd1cmF0aW9uXG4gICAgICAgIGlmICghb3B0aW9ucy5nYXRld2F5Py51cmwpIGJvdC5nYXRld2F5LnVybCA9IGJvdC5nYXRld2F5LmNvbm5lY3Rpb24udXJsXG5cbiAgICAgICAgaWYgKCFvcHRpb25zLmdhdGV3YXk/LnRvdGFsU2hhcmRzKSBib3QuZ2F0ZXdheS50b3RhbFNoYXJkcyA9IGJvdC5nYXRld2F5LmNvbm5lY3Rpb24uc2hhcmRzXG5cbiAgICAgICAgaWYgKCFvcHRpb25zLmdhdGV3YXk/Lmxhc3RTaGFyZElkICYmICFvcHRpb25zLmdhdGV3YXk/LnRvdGFsU2hhcmRzKSBib3QuZ2F0ZXdheS5sYXN0U2hhcmRJZCA9IGJvdC5nYXRld2F5LmNvbm5lY3Rpb24uc2hhcmRzIC0gMVxuICAgICAgfVxuXG4gICAgICBpZiAoIWJvdC5nYXRld2F5LnJlc2hhcmRpbmcuZ2V0U2Vzc2lvbkluZm8pIHtcbiAgICAgICAgYm90LmdhdGV3YXkucmVzaGFyZGluZy5nZXRTZXNzaW9uSW5mbyA9IGFzeW5jICgpID0+IHtcbiAgICAgICAgICByZXR1cm4gYXdhaXQgYm90LnJlc3QuZ2V0R2F0ZXdheUJvdCgpXG4gICAgICAgIH1cbiAgICAgIH1cblxuICAgICAgYXdhaXQgYm90LmdhdGV3YXkuc3Bhd25TaGFyZHMoKVxuICAgIH0sXG5cbiAgICBhc3luYyBzaHV0ZG93bigpIHtcbiAgICAgIHJldHVybiBhd2FpdCBib3QuZ2F0ZXdheS5zaHV0ZG93bihTaGFyZFNvY2tldENsb3NlQ29kZXMuU2h1dGRvd24sICdVc2VyIHJlcXVlc3RlZCBib3Qgc3RvcCcpXG4gICAgfSxcbiAgfVxuXG4gIGJvdC5oZWxwZXJzID0gY3JlYXRlQm90SGVscGVycyhib3QpXG4gIGlmIChvcHRpb25zLmFwcGxpY2F0aW9uSWQpIGJvdC5hcHBsaWNhdGlvbklkID0gYm90LnRyYW5zZm9ybWVycy5zbm93Zmxha2Uob3B0aW9ucy5hcHBsaWNhdGlvbklkKVxuXG4gIHJldHVybiBib3Rcbn1cblxuZXhwb3J0IGludGVyZmFjZSBDcmVhdGVCb3RPcHRpb25zPFRQcm9wcyBleHRlbmRzIFJlY3Vyc2l2ZVBhcnRpYWw8VHJhbnNmb3JtZXJzRGVzaXJlZFByb3BlcnRpZXM+LCBUQmVoYXZpb3IgZXh0ZW5kcyBEZXNpcmVkUHJvcGVydGllc0JlaGF2aW9yPiB7XG4gIC8qKiBUaGUgYm90J3MgdG9rZW4uICovXG4gIHRva2VuOiBzdHJpbmdcbiAgLyoqIEFwcGxpY2F0aW9uIElkIG9mIHRoZSBib3QgaW5jYXNlIGl0IGlzIGFuIG9sZCBib3QgdG9rZW4uICovXG4gIGFwcGxpY2F0aW9uSWQ/OiBCaWdTdHJpbmdcbiAgLyoqIFRoZSBib3QncyBpbnRlbnRzIHRoYXQgd2lsbCBiZSB1c2VkIHRvIG1ha2UgYSBjb25uZWN0aW9uIHdpdGggZGlzY29yZHMgZ2F0ZXdheS4gKi9cbiAgaW50ZW50cz86IEdhdGV3YXlJbnRlbnRzXG4gIC8qKiBBbnkgb3B0aW9ucyB5b3Ugd2lzaCB0byBwcm92aWRlIHRvIHRoZSByZXN0IG1hbmFnZXIuICovXG4gIHJlc3Q/OiBPbWl0PENyZWF0ZVJlc3RNYW5hZ2VyT3B0aW9ucywgJ3Rva2VuJz4gJiBQYXJ0aWFsPFBpY2s8Q3JlYXRlUmVzdE1hbmFnZXJPcHRpb25zLCAndG9rZW4nPj5cbiAgLyoqIEFueSBvcHRpb25zIHlvdSB3aXNoIHRvIHByb3ZpZGUgdG8gdGhlIGdhdGV3YXkgbWFuYWdlci4gKi9cbiAgZ2F0ZXdheT86IE9taXQ8Q3JlYXRlR2F0ZXdheU1hbmFnZXJPcHRpb25zLCAndG9rZW4nPiAmIFBhcnRpYWw8UGljazxDcmVhdGVHYXRld2F5TWFuYWdlck9wdGlvbnMsICd0b2tlbic+PlxuICAvKiogVGhlIGV2ZW50IGhhbmRsZXJzLiAqL1xuICBldmVudHM/OiBQYXJ0aWFsPEV2ZW50SGFuZGxlcnM8Q29tcGxldGVEZXNpcmVkUHJvcGVydGllczxOb0luZmVyPFRQcm9wcz4+LCBUQmVoYXZpb3I+PlxuICAvKiogVGhlIGZ1bmN0aW9ucyB0aGF0IHNob3VsZCB0cmFuc2Zvcm0gZGlzY29yZCBvYmplY3RzIHRvIGRpc2NvcmRlbm8gc2hhcGVkIG9iamVjdHMuICovXG4gIHRyYW5zZm9ybWVycz86IFJlY3Vyc2l2ZVBhcnRpYWw8VHJhbnNmb3JtZXJzPENvbXBsZXRlRGVzaXJlZFByb3BlcnRpZXM8Tm9JbmZlcjxUUHJvcHM+PiwgVEJlaGF2aW9yPj5cbiAgLyoqIFRoZSBoYW5kbGVyIGZ1bmN0aW9ucyB0aGF0IHNob3VsZCBoYW5kbGUgaW5jb21pbmcgZGlzY29yZCBwYXlsb2FkcyBmcm9tIGdhdGV3YXkgYW5kIGNhbGwgYW4gZXZlbnQuICovXG4gIGhhbmRsZXJzPzogUGFydGlhbDxSZWNvcmQ8R2F0ZXdheURpc3BhdGNoRXZlbnROYW1lcywgQm90R2F0ZXdheUhhbmRsZXI8Q29tcGxldGVEZXNpcmVkUHJvcGVydGllczxOb0luZmVyPFRQcm9wcz4+LCBUQmVoYXZpb3I+Pj5cbiAgLyoqXG4gICAqIFNldCB0aGUgZGVzaXJlZCBwcm9wZXJ0aWVzIGZvciB0aGUgYm90XG4gICAqXG4gICAqIEBkZWZhdWx0IHt9XG4gICAqL1xuICBkZXNpcmVkUHJvcGVydGllcz86IFRQcm9wc1xuICAvKipcbiAgICogU2V0IHRoZSBkZXNpcmVkIHByb3BlcnRpZXMgYmVoYXZpb3IgZm9yIHVuZGVzaXJlZCBwcm9wZXJ0aWVzXG4gICAqXG4gICAqIEBkZWZhdWx0IERlc2lyZWRQcm9wZXJ0aWVzQmVoYXZpb3IuUmVtb3ZlS2V5XG4gICAqL1xuICBkZXNpcmVkUHJvcGVydGllc0JlaGF2aW9yPzogVEJlaGF2aW9yXG4gIC8qKlxuICAgKiBUaGlzIGZhY3Rvcnkgd2lsbCBiZSBpbnZva2VkIHRvIGNyZWF0ZSB0aGUgbG9nZ2VyIGZvciBnYXRld2F5LCByZXN0IGFuZCBib3RcbiAgICpcbiAgICogQHJlbWFya3NcbiAgICogSWYgbm90IHByb3ZpZGVkIHRoZSBkZWZhdWx0IGxvZ2dlciB3aWxsIGJlIHVzZWQgd2l0aCByZXN0IGFuZCBnYXRld2F5IHNoYXJpbmcgdGhlIHNhbWUgbG9nZ2VyXG4gICAqXG4gICAqIFRoaXMgZnVuY3Rpb24gd2lsbCBiZSBpbnZva2VkIDMgdGltZXMsIG9uZSB3aXRoIHRoZSBuYW1lIG9mIGBSRVNUYCwgb25lIHdpdGggYEdBVEVXQVlgIGFuZCB0aGUgdGhpcmQgb25lIHdpdGggbmFtZSBgQk9UYFxuICAgKi9cbiAgbG9nZ2VyRmFjdG9yeT86IChuYW1lOiAnUkVTVCcgfCAnR0FURVdBWScgfCAnQk9UJykgPT4gUGljazx0eXBlb2YgbG9nZ2VyLCAnZGVidWcnIHwgJ2luZm8nIHwgJ3dhcm4nIHwgJ2Vycm9yJyB8ICdmYXRhbCc+XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgQm90PFxuICBUUHJvcHMgZXh0ZW5kcyBUcmFuc2Zvcm1lcnNEZXNpcmVkUHJvcGVydGllcyA9IFRyYW5zZm9ybWVyc0Rlc2lyZWRQcm9wZXJ0aWVzLFxuICBUQmVoYXZpb3IgZXh0ZW5kcyBEZXNpcmVkUHJvcGVydGllc0JlaGF2aW9yID0gRGVzaXJlZFByb3BlcnRpZXNCZWhhdmlvci5SZW1vdmVLZXksXG4+IHtcbiAgLyoqIFRoZSBpZCBvZiB0aGUgYm90LiAqL1xuICBpZDogYmlnaW50XG4gIC8qKiBUaGUgYXBwbGljYXRpb24gaWQgb2YgdGhlIGJvdC4gVGhpcyBpcyB1c3VhbGx5IHRoZSBzYW1lIGFzIGlkIGJ1dCBpbiB0aGUgY2FzZSBvZiBvbGQgYm90cyBjYW4gYmUgZGlmZmVyZW50LiAqL1xuICBhcHBsaWNhdGlvbklkOiBiaWdpbnRcbiAgLyoqIFRoZSByZXN0IG1hbmFnZXIuICovXG4gIHJlc3Q6IFJlc3RNYW5hZ2VyXG4gIC8qKiBUaGUgZ2F0ZXdheSBtYW5hZ2VyLiAqL1xuICBnYXRld2F5OiBHYXRld2F5TWFuYWdlclxuICAvKiogVGhlIGV2ZW50IGhhbmRsZXJzLiAqL1xuICBldmVudHM6IFBhcnRpYWw8RXZlbnRIYW5kbGVyczxUUHJvcHMsIFRCZWhhdmlvcj4+XG4gIC8qKiBBIGxvZ2dlciB1dGlsaXR5IHRvIG1ha2UgaXQgZWFzeSB0byBsb2cgbmljZSBhbmQgdXNlZnVsIHRoaW5ncyBpbiB0aGUgYm90IGNvZGUuICovXG4gIGxvZ2dlcjogUGljazx0eXBlb2YgbG9nZ2VyLCAnZGVidWcnIHwgJ2luZm8nIHwgJ3dhcm4nIHwgJ2Vycm9yJyB8ICdmYXRhbCc+XG4gIC8qKiBUaGUgZnVuY3Rpb25zIHRoYXQgc2hvdWxkIHRyYW5zZm9ybSBkaXNjb3JkIG9iamVjdHMgdG8gZGlzY29yZGVubyBzaGFwZWQgb2JqZWN0cy4gKi9cbiAgdHJhbnNmb3JtZXJzOiBUcmFuc2Zvcm1lcnM8VFByb3BzLCBUQmVoYXZpb3I+ICYge1xuICAgICRpbmZlcnJlZFR5cGVzOiB7XG4gICAgICBbSyBpbiBrZXlvZiBUcmFuc2Zvcm1lcnNPYmplY3RzXTogU2V0dXBEZXNpcmVkUHJvcHM8VHJhbnNmb3JtZXJzT2JqZWN0c1tLXSwgVFByb3BzLCBUQmVoYXZpb3I+XG4gICAgfVxuICB9XG4gIC8qKiBUaGUgaGFuZGxlciBmdW5jdGlvbnMgdGhhdCBzaG91bGQgaGFuZGxlIGluY29taW5nIGRpc2NvcmQgcGF5bG9hZHMgZnJvbSBnYXRld2F5IGFuZCBjYWxsIGFuIGV2ZW50LiAqL1xuICBoYW5kbGVyczogR2F0ZXdheUhhbmRsZXJzPFRQcm9wcywgVEJlaGF2aW9yPlxuICBoZWxwZXJzOiBCb3RIZWxwZXJzPFRQcm9wcywgVEJlaGF2aW9yPlxuICAvKiogU3RhcnQgdGhlIGJvdCBjb25uZWN0aW9uIHRvIHRoZSBnYXRld2F5LiAqL1xuICBzdGFydDogKCkgPT4gUHJvbWlzZTx2b2lkPlxuICAvKiogU2h1dHMgZG93biBhbGwgdGhlIGJvdCBjb25uZWN0aW9ucyB0byB0aGUgZ2F0ZXdheS4gKi9cbiAgc2h1dGRvd246ICgpID0+IFByb21pc2U8dm9pZD5cbn1cblxuLyoqIEBpbnRlcm5hbCBUaGlzIGlzIHN1YmplY3QgdG8gYnJlYWtpbmcgY2hhbmdlcyB3aXRob3V0IG5vdGljZSAqL1xuZXhwb3J0IHR5cGUgSW50ZXJuYWxCb3QgPSBCb3Q8Q29tcGxldGVEZXNpcmVkUHJvcGVydGllczx7fSwgdHJ1ZT4sIERlc2lyZWRQcm9wZXJ0aWVzQmVoYXZpb3IuUmVtb3ZlS2V5PlxuIl0sIm5hbWVzIjpbIlNoYXJkU29ja2V0Q2xvc2VDb2RlcyIsImNyZWF0ZUdhdGV3YXlNYW5hZ2VyIiwiY3JlYXRlUmVzdE1hbmFnZXIiLCJjcmVhdGVMb2dnZXIiLCJnZXRCb3RJZEZyb21Ub2tlbiIsImNyZWF0ZUJvdEdhdGV3YXlIYW5kbGVycyIsImNyZWF0ZUJvdEhlbHBlcnMiLCJjcmVhdGVUcmFuc2Zvcm1lcnMiLCJjcmVhdGVCb3QiLCJvcHRpb25zIiwidHJhbnNmb3JtZXJzIiwiZGVzaXJlZFByb3BlcnRpZXMiLCJyZXN0IiwidG9rZW4iLCJhcHBsaWNhdGlvbklkIiwibG9nZ2VyIiwibG9nZ2VyRmFjdG9yeSIsImdhdGV3YXkiLCJldmVudHMiLCJtZXNzYWdlIiwic2hhcmQiLCJkYXRhIiwiYm90IiwicmF3IiwiaWQiLCJ0IiwiZGlzcGF0Y2hSZXF1aXJlbWVudHMiLCJoYW5kbGVycyIsImludGVudHMiLCJwcmVmZXJTbmFrZUNhc2UiLCJuYW1lIiwiaGVscGVycyIsInN0YXJ0IiwiY29ubmVjdGlvbiIsImdldFNlc3Npb25JbmZvIiwidXJsIiwidG90YWxTaGFyZHMiLCJzaGFyZHMiLCJsYXN0U2hhcmRJZCIsInJlc2hhcmRpbmciLCJnZXRHYXRld2F5Qm90Iiwic3Bhd25TaGFyZHMiLCJzaHV0ZG93biIsIlNodXRkb3duIiwic25vd2ZsYWtlIl0sIm1hcHBpbmdzIjoiQUFDQSxTQUFTQSxxQkFBcUIsRUFBRUMsb0JBQW9CLFFBQVEsc0JBQXFCO0FBRWpGLFNBQVNDLGlCQUFpQixRQUFRLG1CQUFrQjtBQUVwRCxTQUFTQyxZQUFZLEVBQUVDLGlCQUFpQixRQUFxQixvQkFBbUI7QUFTaEYsU0FBdURDLHdCQUF3QixRQUFRLGdCQUFlO0FBQ3RHLFNBQTBCQyxnQkFBZ0IsUUFBUSxlQUFjO0FBQ2hFLFNBQTRCQyxrQkFBa0IsUUFBUSxvQkFBbUI7QUFtQnpFLE9BQU8sU0FBU0MsVUFHZEMsT0FBNEM7SUFJNUMsSUFBSSxDQUFDQSxRQUFRQyxZQUFZLEVBQUVELFFBQVFDLFlBQVksR0FBRyxDQUFDO0lBQ25ELElBQUksQ0FBQ0QsUUFBUUMsWUFBWSxDQUFDQyxpQkFBaUIsRUFBRUYsUUFBUUMsWUFBWSxDQUFDQyxpQkFBaUIsR0FBR0YsUUFBUUUsaUJBQWlCO0lBQy9HLElBQUksQ0FBQ0YsUUFBUUcsSUFBSSxFQUFFSCxRQUFRRyxJQUFJLEdBQUc7UUFBRUMsT0FBT0osUUFBUUksS0FBSztRQUFFQyxlQUFlTCxR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